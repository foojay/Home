---
layout: post
title:  "Java注册激活邮件"
date:   2017-01-06 08:27:00
categories: java
excerpt: Java注册激活邮件
---

* content
{:toc}




### 场景

在很多网站注册的时候，为了验证用户信息的真实合法，往往需要验证用户所填邮件的准

确性。形式为：用户注册时填写邮箱，注册完成后，网站会向用户所填邮箱发送一封激活

邮件，用户点击激活邮件中的链接后，方可完成注册。

### 核心代码


    public class UserManager {
        /**
         * 注册用户 
         * @param username 用户名
         * @param password 密码
         * @param email 邮箱
         * @return 是否注册成功
         */
        public Boolean Register(String username,String password,String email){
            Boolean result=false;
            //生成用户code
            String code=UUID.randomUUID().toString().replace("-", "");
            //添加用户
            UserDao userDao=new UserDao();
            result=userDao.AddUser(username, password, email, code);
            //向用户发送激活邮件
            sendMail(email,code);
            return result;
        }
        /**
         * 发送激活邮件
         * @param to 收件人邮箱地址
         * @param code 激活码
         */
        public static boolean sendMail(String to, String code) {  
            try {  
                Properties props = new Properties();  
                props.put("username", "huyuyang6688@163.com");   
                props.put("password", "123456");   
                props.put("mail.transport.protocol", "smtp" );  
                props.put("mail.smtp.host", "smtp.163.com");  
                props.put("mail.smtp.port", "25" );  
                Session mailSession = Session.getDefaultInstance(props);  
                Message msg = new MimeMessage(mailSession);     
                msg.setFrom(new InternetAddress("huyuyang6688@163.com"));  
                msg.addRecipients(Message.RecipientType.TO, InternetAddress.parse(to));   
                msg.setSubject("激活邮件");   
                msg.setContent("<h1>此邮件为官方激活邮件！请点击下面链接完成激活操作！</h1><h3><a href='http://localhost:8080/SendMail/servlet/ActiveServlet?code="+code+"'>http://localhost:8080/SendMail/servlet/ActiveServlet</a></h3>","text/html;charset=UTF-8");
                msg.saveChanges();  
                Transport transport = mailSession.getTransport("smtp");  
                transport.connect(props.getProperty("mail.smtp.host"), props  
                        .getProperty("username"), props.getProperty("password"));   
                transport.sendMessage(msg, msg.getAllRecipients());  
                transport.close();     
            } catch (Exception e) {  
                e.printStackTrace();  
                System.out.println(e);  
                return false;  
            }  
            return true;  
        }   
        /**
         * 激活用户
         * @param code 用户激活码
         * @return 是否激活成功
         */
        public Boolean Active(String code){
            UserDao userDao=new UserDao();
            String username=userDao.findUserByCode(code);
            if(username!=null && username!=""){
                //如果存在用户，将此用户状态设为可用
                userDao.setState(username);
                return true;
            }else{
                return false;
            }
        }
    }


  当用户注册时

　　1、为用户生成随机的激活码（此激活码是添加根据代码规则自动生成的，这里的激活

码以随机生成的UUID为例）；

　　2、添加一条用户记录；

　　3、向用户发送激活邮件。上述代码中的发信人是小编自己的邮箱，一般为企业邮箱。

如果有条件的话，这里还向大家推荐一款邮箱服务器——易邮邮件服务器，可以在局域网内

建立邮件系统进行测试。